<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfath Spare Parts - Purchases</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/renderer/css/style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar (same as dashboard) -->
        <nav class="sidebar">
            <!-- Sidebar content from dashboard -->
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="top-bar">
                <div class="toggle-sidebar">
                    <i class="bi bi-list"></i>
                </div>
                <div class="page-title">
                    <h3>Purchase Management</h3>
                </div>
                <div class="top-bar-actions">
                    <button class="btn btn-sm btn-primary" id="new-purchase-btn">
                        <i class="bi bi-plus-circle"></i> New Purchase
                    </button>
                </div>
            </div>

            <!-- Purchase Content -->
            <div class="purchase-content">
                <!-- Filters Row -->
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Search</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="search-purchases" placeholder="Invoice # or supplier">
                                    <button class="btn btn-outline-secondary" type="button" id="search-purchases-btn">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Supplier</label>
                                <select class="form-select" id="filter-supplier">
                                    <option value="">All Suppliers</option>
                                    <!-- Filled by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="filter-status">
                                    <option value="">All Statuses</option>
                                    <option value="pending">Pending</option>
                                    <option value="paid">Paid</option>
                                    <option value="partial">Partial</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Date Range</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="date-from">
                                    <span class="input-group-text">to</span>
                                    <input type="date" class="form-control" id="date-to">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Actions</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary w-100" id="filter-purchases-btn">
                                        <i class="bi bi-funnel"></i> Filter
                                    </button>
                                    <button class="btn btn-outline-secondary w-100" id="reset-filters-btn">
                                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purchases Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Purchase Orders</h5>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-success" id="export-excel-btn">
                                    <i class="bi bi-file-earmark-excel"></i> Excel
                                </button>
                                <button class="btn btn-sm btn-outline-danger" id="export-pdf-btn">
                                    <i class="bi bi-file-earmark-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="purchases-table">
                                <thead>
                                    <tr>
                                        <th>PO #</th>
                                        <th>Date</th>
                                        <th>Supplier</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Paid</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Purchases pagination">
                            <ul class="pagination justify-content-center mt-3" id="pagination">
                                <!-- Filled by JavaScript -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Purchase Modal -->
    <div class="modal fade" id="purchaseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="purchase-modal-title">New Purchase Order</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="purchase-form">
                        <input type="hidden" id="purchase-id">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="po-number" class="form-label">PO Number*</label>
                                    <input type="text" class="form-control" id="po-number" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="purchase-date" class="form-label">Date*</label>
                                    <input type="date" class="form-control" id="purchase-date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="supplier" class="form-label">Supplier*</label>
                                    <select class="form-select" id="supplier" required>
                                        <option value="">Select Supplier</option>
                                        <!-- Filled by JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Purchase Items -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Purchase Items</h5>
                                    <button type="button" class="btn btn-sm btn-primary" id="add-purchase-item-btn">
                                        <i class="bi bi-plus-circle"></i> Add Item
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="purchase-items-table">
                                        <thead>
                                            <tr>
                                                <th>Item</th>
                                                <th>Quantity</th>
                                                <th>Unit Price</th>
                                                <th>Total</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Filled by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Information -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Payment Information</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="payment-status" class="form-label">Payment Status*</label>
                                            <select class="form-select" id="payment-status" required>
                                                <option value="pending">Pending</option>
                                                <option value="paid">Paid</option>
                                                <option value="partial">Partial</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="paid-amount" class="form-label">Paid Amount</label>
                                            <input type="number" class="form-control" id="paid-amount" min="0" step="0.01" value="0">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="purchase-totals">
                                            <div class="d-flex justify-content-between">
                                                <span>Subtotal:</span>
                                                <span id="purchase-subtotal">0.00</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Tax:</span>
                                                <span id="purchase-tax">0.00</span>
                                            </div>
                                            <hr>
                                            <div class="d-flex justify-content-between total-row">
                                                <span><strong>Total:</strong></span>
                                                <span id="purchase-total"><strong>0.00</strong></span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Balance:</span>
                                                <span id="purchase-balance">0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3 mt-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-purchase-btn">Save Purchase</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Purchase Item Modal -->
    <div class="modal fade" id="purchaseItemModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Purchase Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="purchase-item-form">
                        <input type="hidden" id="purchase-item-id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="purchase-item" class="form-label">Item*</label>
                                    <select class="form-select" id="purchase-item" required>
                                        <option value="">Select Item</option>
                                        <!-- Filled by JavaScript -->
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="purchase-item-cost" class="form-label">Cost Price*</label>
                                    <input type="number" class="form-control" id="purchase-item-cost" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="purchase-item-qty" class="form-label">Quantity*</label>
                                    <input type="number" class="form-control" id="purchase-item-qty" min="1" required>
                                </div>
                                <div class="mb-3">
                                    <label for="purchase-item-total" class="form-label">Total</label>
                                    <input type="number" class="form-control" id="purchase-item-total" readonly>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-purchase-item-btn">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Purchase Modal -->
    <div class="modal fade" id="viewPurchaseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Purchase Order #<span id="view-po-number"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>Supplier:</strong> <span id="view-supplier"></span></p>
                            <p><strong>Date:</strong> <span id="view-date"></span></p>
                        </div>
                        <div class="col-md-6 text-end">
                            <p><strong>Status:</strong> <span class="badge" id="view-status"></span></p>
                            <p><strong>Total:</strong> <span id="view-total"></span></p>
                        </div>
                    </div>

                    <div class="table-responsive mb-3">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="view-purchase-items">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Payment Information</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Payment Status:</strong> <span id="view-payment-status"></span></p>
                                    <p><strong>Paid Amount:</strong> <span id="view-paid-amount"></span></p>
                                    <p><strong>Balance:</strong> <span id="view-balance"></span></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Notes</h5>
                                </div>
                                <div class="card-body">
                                    <p id="view-notes">No notes available</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="print-purchase-btn">
                        <i class="bi bi-printer"></i> Print PO
                    </button>
                    <button type="button" class="btn btn-success" id="add-payment-btn" style="display: none;">
                        <i class="bi bi-cash"></i> Add Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Payment for PO #<span id="payment-po-number"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="payment-form">
                        <div class="mb-3">
                            <label for="payment-amount" class="form-label">Amount*</label>
                            <input type="number" class="form-control" id="payment-amount" min="0" step="0.01" required>
                            <small class="text-muted">Balance: <span id="payment-balance"></span></small>
                        </div>
                        <div class="mb-3">
                            <label for="payment-method" class="form-label">Payment Method*</label>
                            <select class="form-select" id="payment-method" required>
                                <option value="cash">Cash</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="cheque">Cheque</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="payment-date" class="form-label">Date*</label>
                            <input type="date" class="form-control" id="payment-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="payment-notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="payment-notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-payment-btn">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="/renderer/js/renderer.js"></script>
    <script src="/renderer/js/purchase.js"></script>
</body>
</html>